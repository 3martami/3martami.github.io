<html lang="es">
<head>
	<title>Visor TFM Marta</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="author" content="Marta Miralles Mora"/>
	<meta name="description" content="Visor web de serveis per SPEIS, comarca de La Segarra">
	<meta name="robots" content="index,follow">  <!--Això no sé que vol dir -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" />
	<link rel="stylesheet" href="css/L.Control.MousePosition.css" />

	<style>
		body {
			margin: 0;
			padding: 0;
			overflow: hidden;
		}
		#map {
			height: 100%;
			width: 100%;
			background-color: #ffffff
		}


		#contenedor{position: absolute;
					width: 100px;
					height: 100px;
					left: 50px;
					top: 10px;
					border: 2px solid grey;
					z-index: 1;
					border-radius: 30px;
					background-color: white;
					opacity: 0.8;}












	</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>
<script src="js/leaflet.ajax.min.js"></script>	<!-- Ordre per poder carregar capes Geojson -->
<script src="js/L.Control.MousePosition.js"></script>





<script>


var map;
var osm;
var esri;
var Municipis;
var Parcs;
var controlCapas;
var serveiOrtoCache;
var CapaPistes;
var CapaPuntsAigua;
var CapaHidrants;
var CapaCarreteres
var icona_aigua




function init(){

           /*crs25831 = new L.Proj.CRS('EPSG:25831','+proj=utm +zone=31 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs',
                          {
                               resolutions: [1100, 550, 275, 100, 50, 25, 10, 5, 2, 1, 0.5, 0.25]
                          }
                 );*/




 map = L.map('map', {center: [41.746492, 1.309450],zoom: 10});


		esri = L.tileLayer(
		/*Canviar aquesta capa de esri per un servei WMS del ICGC*/
				'http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
				{
					maxZoom : 17,
					minZoom : 1,
					attribution : 'Tiles © Esri',

				}); esri.addTo(map);



		serveiOrtoCache =  L.tileLayer('https://geoserveis.icgc.cat/icc_mapesmultibase/noutm/wmts/orto/GRID3857/{z}/{x}/{y}.jpeg',{

                        continuousWorld: true,
                        attribution: 'Institut Cartogràfic i Geològic de Catalunya -ICGC',
                  });/*http://www.icgc.cat/es/Administracion-y-empresa/Servicios/Servicios-en-linea-Geoservicios/Servicios-para-API-y-Widgets/API-de-Leaflet*/

		osm = L.tileLayer('https://geoserveis.icgc.cat/icc_mapesmultibase/noutm/wmts/topo/GRID3857/{z}/{x}/{y}.jpeg', {  /*Canviar aquesta capa osm per un servei WMS del ICGC*/
 				maxZoom: 19,
 				minZoom: 1,
 				attribution: 'OSM'
 		});





		Municipis = L.geoJson.ajax('datos/Municipis_Segarraok.geojson', {

				style: function (feature) {
							return {color:'#000000',weight:0.5,fillColor: "#ff7800", fillOpacity: 0.4,opacity: 1,};
				},
				onEachFeature: function(feature, layer) {
		 			popupContent ="<b>"+feature.properties.MUNICIPI+"</b>";
		 			layer.bindPopup(popupContent);
		 		}
				}).addTo(map);



	var icona_parc=L.icon({
    iconUrl: 'images/iconaParc.png',
    iconSize:     [16, 16], // size of the icon
    iconAnchor:   [8, 8], // point of the icon which will correspond to marker's location
});


		Parcs=L.geoJson.ajax('datos/parcs_bombersOK.geojson', {

				pointToLayer: function (feature, latlng) {
										return L.marker(latlng, {
											icon: icona_parc
										});
										},
				         onEachFeature: function(feature, layer) {
		 			popupContent ="<b>"+feature.properties.NOM+"</b>";
		 			layer.bindPopup(popupContent);
		 		}
				});




		CapaHidrants=L.geoJson.ajax('datos/Hidrants_OK.geojson', {
				attribution: 'Consell', 
				pointToLayer: function (feature, latlng) {
										return L.circleMarker(latlng, {
											radius: 1,
									        color: "#06BAFF",
											opacity: 1,
											fillOpacity: 1,
										});
										},
										});
			icona_aigua=L.icon({
				iconUrl: 'images/IconaPuntAigua.png',
				iconSize: [13, 13],
				iconAnchor: [8, 8],
		});

		CapaPuntsAigua=L.geoJson.ajax('datos/Punts_aigua_OK.geojson', {

				pointToLayer: function (feature, latlng) {
										return L.marker(latlng, {
											icon: icona_aigua
											
											});
											},
											});
		





		CapaPistes = L.geoJson.ajax('datos/Pistes_2D_OK.geojson', {

				style: function (feature) {
							return {color:'#000000',weight: 2,opacity: 1,};
				},
				});
				/*No es veu la capa de Pistes*/

		CapaCarreteres = L.geoJson.ajax('datos/Carreteres_2D.geojson', {

				style: function (feature) {
							return {color:'#000000',weight: 2,opacity: 1,};
				},
				});

				/*No es veu la capa de Carreteres*/








 var baseMaps = {   /*Aquí anar afegint les capes Base (serà servei WMS orto i topo) */
	     "Topogràfic": osm,
		 "Ortofoto" : esri,
		 "orto_ICGC":serveiOrtoCache
		 };



 var overlayMaps = {
			"Parcs de bombers": Parcs,
			"Límits municipals": Municipis,
			"Pistes secundàries (3 a 5 m)" : CapaPistes,
			"Carreteres" : CapaCarreteres,
			"Hidrants" : CapaHidrants,
			"Punts d'aigua" : CapaPuntsAigua


		};



	controlCapas=L.control.layers(baseMaps, overlayMaps,{collapsed:false, position: 'topleft'});
	controlCapas.addTo(map);
  L.control.mousePosition().addTo(map);

 }



 function Vista(){
		map.setView([41.746492, 1.309450],11);
 }







</script>
</head>
<body onLoad="init()">
	<div id="map"></div>

	<div id="contenedor">
	<a href="#" onClick="Vista()">Vista general</a>
	</div>



</body>
</html>
